<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Home Page</title>
</head>
<body>
  <nav>
    <button id="saveButton" onclick="saveButton()">Save html</button>
    <a id="parentContentLink" href='javascript:goHomePage()'>Home</a>
    <select id="childSubjects">
      <option value="home">Home</option>
      <!-- Children are added here onload with setChildSubjects -->
    </select>
    <!-- Add a previous and next button for prior requests? -->
    <!-- Add a button to save the current page as a markdown file -->
  </nav>

  <div id="content">  
    <div id="parentContent">
        <p>Here are two fruits:</p>
<ol>
<li><strong>Apple</strong></li>
<li><strong>Banana</strong></li>
</ol>
<p>Would you like to know more about these fruits or are there other fruits you're interested in?</p>

    </div>
    <div id="childDivs">
      <div title="Apple" id="childContent1" onclick="setVisibileChild('childContent1')" hidden=true><h1>Apple</h1>
<h2>Overview</h2>
<p>The apple, scientifically known as <em>Malus domestica</em>, is one of the most widely cultivated tree fruits. Originating from Central Asia, apples have been grown for thousands of years and are now available in numerous varieties worldwide.</p>
<h2>Nutritional Profile</h2>
<p>Apples are packed with essential nutrients:</p>
<ul>
<li><strong>Vitamin C</strong>: An antioxidant that supports immune health.</li>
<li><strong>Fiber</strong>: Aids in digestion and helps maintain bowel health.</li>
<li><strong>Quercetin</strong>: A flavonoid that may have anti-inflammatory effects.</li>
</ul>
<h3>Nutritional Breakdown (per 100g)</h3>
<ul>
<li><strong>Calories</strong>: 52</li>
<li><strong>Carbohydrates</strong>: 13.81g</li>
<li><strong>Fiber</strong>: 2.4g</li>
<li><strong>Sugars</strong>: 10.39g</li>
<li><strong>Vitamin C</strong>: 4.6mg (8% DV)</li>
<li><strong>Potassium</strong>: 107mg (2% DV)</li>
</ul>
<h2>Varieties</h2>
<p>There are over 7,500 known varieties of apples, each with unique flavors, textures, and uses. Some popular types include:</p>
<ul>
<li><strong>Granny Smith</strong>: Known for its tart flavor and green color, ideal for baking.</li>
<li><strong>Fuji</strong>: Sweet and crisp, great for eating fresh.</li>
<li><strong>Gala</strong>: Mildly sweet with a firm texture, versatile for snacking and cooking.</li>
<li><strong>Honeycrisp</strong>: Juicy and sweet with a crisp texture, excellent for eating raw.</li>
</ul>
<h2>Health Benefits</h2>
<p>Apples offer numerous health benefits:</p>
<ul>
<li><strong>Heart Health</strong>: The fiber in apples can help lower cholesterol levels.</li>
<li><strong>Weight Management</strong>: Apples are low in calories and high in fiber, making them a filling snack.</li>
<li><strong>Diabetes Management</strong>: Some studies suggest that apples can help regulate blood sugar levels.</li>
<li><strong>Cancer Prevention</strong>: The antioxidants in apples may reduce the risk of certain cancers.</li>
</ul>
<h2>Culinary Uses</h2>
<p>Apples are versatile in the kitchen:</p>
<ul>
<li><strong>Raw</strong>: Enjoyed as a healthy snack or in salads.</li>
<li><strong>Baked</strong>: Used in pies, tarts, and crisps.</li>
<li><strong>Cooked</strong>: Incorporated into sauces, like applesauce, or used in savory dishes.</li>
<li><strong>Juiced</strong>: Pressed into juice or cider, either fresh or fermented.</li>
</ul>
<h2>Cultural Significance</h2>
<p>Apples have a rich cultural history:</p>
<ul>
<li><strong>Mythology</strong>: In Greek mythology, apples are associated with love and beauty, as seen in the story of the golden apple of discord.</li>
<li><strong>Folklore</strong>: The phrase "an apple a day keeps the doctor away" highlights the fruit's reputation for promoting health.</li>
<li><strong>Traditions</strong>: Apples are used in various cultural traditions, such as bobbing for apples at Halloween.</li>
</ul>
<h2>Environmental Impact</h2>
<p>Apple cultivation has both positive and negative environmental impacts:</p>
<ul>
<li><strong>Positive</strong>: Apple orchards can support biodiversity by providing habitats for various species.</li>
<li><strong>Negative</strong>: The use of pesticides and fertilizers in commercial apple farming can lead to soil and water pollution.</li>
</ul>
<h2>Conclusion</h2>
<p>Apples are not only delicious but also nutritionally rich and versatile. Whether eaten fresh, cooked, or juiced, apples contribute to a healthy diet and have a significant place in global culture and cuisine.</p>
<p>ResponseID:4845cdc7-6fdb-4b</p>
</div><div title="Banana

Followup questions
- Do you have a favorite fruit?
- Are you looking for information on the" id="childContent2" onclick="setVisibileChild('childContent2')" hidden=true><h1>Banana</h1>
<p>The banana is a widely consumed fruit, scientifically classified under the genus Musa. Here are detailed insights into the banana:</p>
<ul>
<li><p><strong>Origin and Cultivation</strong>: Bananas are believed to have originated in Southeast Asia, with evidence suggesting their domestication around 8000 BCE. They are now cultivated in over 130 countries, with major producers including India, China, and Ecuador.</p>
</li>
<li><p><strong>Varieties</strong>: There are over 1,000 varieties of bananas worldwide, but the most commonly consumed in Western markets is the Cavendish banana. Other notable varieties include the Plantain, used more like a vegetable in cooking, and the Red banana, which has a sweeter taste.</p>
</li>
<li><p><strong>Nutritional Value</strong>: Bananas are rich in potassium, vitamin B6, vitamin C, and dietary fiber. A medium-sized banana contains about 105 calories, making it a healthy snack option. The fruit's high potassium content is beneficial for heart health, helping to manage blood pressure.</p>
</li>
<li><p><strong>Culinary Uses</strong>: Beyond being eaten raw, bananas are versatile in culinary applications. They can be used in baking (banana bread, muffins), cooking (fried bananas, banana chips), and even in beverages (smoothies, banana milkshakes).</p>
</li>
<li><p><strong>Cultural Significance</strong>: In many cultures, bananas hold symbolic meanings. For instance, in Hindu rituals, bananas are offered to deities. In some African and Asian cultures, banana plants are used in ceremonies and as a symbol of fertility.</p>
</li>
<li><p><strong>Environmental Impact</strong>: Banana cultivation can have significant environmental impacts, including water usage, pesticide use, and deforestation. However, there are also sustainable farming practices emerging to mitigate these effects.</p>
</li>
<li><p><strong>Health Benefits</strong>: Apart from the nutritional aspects, bananas are known for their digestive benefits, aiding in both constipation and diarrhea. They also contain tryptophan, which the body converts into serotonin, potentially improving mood.</p>
</li>
<li><p><strong>Economic Importance</strong>: The banana industry is a significant part of the global economy, with billions of dollars in trade annually. It provides employment and income for millions of people worldwide.</p>
</li>
</ul>
<p>ResponseID:acfb28d0-3bea-44</p>
</div>
    </div>
  </div>

    <script>
        function saveButton() {
          const content = document.documentElement.outerHTML; // Get the entire HTML content
          const blob = new Blob([content], { type: 'text/html' }); // Create a Blob from the content
          const url = URL.createObjectURL(blob); // Create a URL for the Blob
          const divInnerText = document.getElementById('content').innerText;
          let filename = divInnerText.substring(0, 25);
          const a = document.createElement('a'); // Create an anchor element
          a.href = url; // Set the href to the Blob URL
          
        a.download =  filename + '.html'; // Set the download attribute with a filename
          document.body.appendChild(a); // Append the anchor to the body
          a.click(); // Programmatically click the anchor to trigger the download
          document.body.removeChild(a); // Remove the anchor from the document
          URL.revokeObjectURL(url); // Release the Blob URL
        }
    </script>

    <script>
      function setChildSubjects(){
        let dropDownOptions = [];
        let childSubjects = document.getElementById('childDivs');
        for (let child of childSubjects.children){
           let subject = child.title;
           let optionValue = child.id;

           dropDownOptions.push({subject: subject, value: optionValue});
        
        }

        for (let option of dropDownOptions){
          let optionElement = document.createElement('option');
          optionElement.value = option.value;
          optionElement.text = option.subject;
          document.getElementById('childSubjects').appendChild(optionElement);
        }

        document.getElementById('childSubjects').addEventListener('change', function() {
          if(this.value == "home"){
            goHomePage();
          }else{
            setVisibleChild(this.value);
          }

          }
        );
      }
    </script>


    <script>
      function setVisibleChild(id){
        //quick flicker home to reset state, this allows hoping between child views
     
    
           let topNode = document.getElementById('content');
           let parentNode = document.getElementById('parentContent');
           let childVisibleNode = document.getElementById(id);
           let childDivs = document.getElementById('childDivs');
           for (let child of childDivs.children){
            if(child.id != id){
              child.hidden = true;
            }else{
              child.hidden = false; //redudant
            }
           }
           parentNode.hidden = true;
           childVisibleNode.hidden = false;
         }
      
    </script>

    <script>
      function goHomePage(){
         let topNode = document.getElementById('content');
         let parentNode = document.getElementById('parentContent');
         let children = document.getElementById('childDivs');
         for (let child of children.children){
            child.hidden = true;
         }
         parentNode.hidden = false;
      }
    </script>

    <script>
      function setChildLinks(){
        let children = document.getElementById('childDivs'); 
        let childSubjects = [];
        let discoveredMatches = [];

        
        for (let child of children.children){
          let subject = child.title;
          childSubjects.push({subject: subject, child: child});
          }
             
          let parentNodeH2Subjects = []
          let parentNodeH3Subjects = []
          let parentNodeH4Subjects = []
          let parentNode = document.getElementById('parentContent');
          let H2s = parentNode.getElementsByTagName("H2");
          let H3s = parentNode.getElementsByTagName("H3");
          let H4s = parentNode.getElementsByTagName("H4");
          let isH2Match = false;
          let isH3Match = false;
          let isH4Match = false;

          H2s.length > 0? parentNodeH2Subjects = H2s.map(item => ({subject: item.innerText, item: item})):isH2Match = false;
          H3s.length > 0?parentNodeH3Subjects = H3s.map(item => ({subject: item.innerText, item: item})):isH3Match = false;
          H4s.length > 0?parentNodeH4Subjects = H4s.map(item => ({subject: item.innerText, item: item})):isH4Match = false;

          
           isH3Match = H3s.length == childSubjects.length;
           isH2Match = H2s.length == childSubjects.length;
           isH4Match = H4s.length == childSubjects.length;
          let allDiscovered = false;

          if (isH3Match){
            //We have a match.  We need to find the H2s
            allDiscovered = true;
          }
          if (isH2Match){
            //We have a match.  We need to find the H3s
            allDiscovered = true;
          }
          if (isH4Match){
            //We have a match.  We need to find the H2s
            allDiscovered = true;
          }

          if(allDiscovered && (isH3Match + isH2Match + isH4Match) > 1){
            //wierd.  ok we work from scratch.
            allDiscovered = false;
          }

          if(!allDiscovered){

            let fluffWords = ["a", "an", "the", "and", "but", "or", "for", "nor", "on", "at", "to", "from", "by", "with", "of"];
            let fluffWordsRegex = new RegExp(fluffWords.join("|"), "g");
          
          //OK time to stumble through unpredictable llm output
          //First check if the child subjects are in the parent node h2 subjects
          let isH2 = false;
          let isH3 = false;
          let isH4 = false;
      
          //This can be optimized later.  Probably doesnt matter since it is client side with modern computing.
          for (let i = 0; i < parentNodeH2Subjects.length; i++){
            let subject = parentNodeH2Subjects[i].subject;
            for (let j = 0; j < childSubjects.length; j++){
              let childSubject = childSubjects[j].subject;
              if(childSubject.replace(fluffWordsRegex, "") == subject.replace(fluffWordsRegex, "")){
                isH2 = true;
                discoveredMatches.push({parentLink: parentNodeH2Subjects[i].item, childLink: childSubjects[j].child});
              }
            }

          }
         
          if(!isH2){
            for (let i = 0; i < parentNodeH3Subjects.length; i++){
              let subject = parentNodeH3Subjects[i].subject;
              for (let j = 0; j < childSubjects.length; j++){
                let childSubject = childSubjects[j].subject;  
                if(childSubject.replace(fluffWordsRegex, "") == subject.replace(fluffWordsRegex, "")){
                  isH3 = true;
                  discoveredMatches.push({parentLink: parentNodeH3Subjects[i].item, childLink: childSubjects[j].child});
                }
              }
            }
          }

          if(!isH3){
            for (let i = 0; i < parentNodeH4Subjects.length; i++){
              let subject = parentNodeH4Subjects[i].subject;
              for (let j = 0; j < childSubjects.length; j++){
                let childSubject = childSubjects[j].subject;
                if(childSubject.replace(fluffWordsRegex, "") == subject.replace(fluffWordsRegex, "")){
                  isH4 = true;
                  discoveredMatches.push({parentLink: parentNodeH4Subjects[i].item, childLink: childSubjects[j].child});
                }
              }
            }
          }

          if(!isH4){
              //I suppose there are edge cases but this surely covers 99.9% of the cases.
          }

          }else{
            if(isH3Match){
              for (let i = 0; i < parentNodeH3Subjects.length; i++){
                let child = childSubjects[i].child;
                makeChildLinks(parentNodeH3Subjects[i].item, child);
              }
              return; //bye bye
            }
            if(isH2Match){
              for (let i = 0; i < parentNodeH2Subjects.length; i++){
                let child = childSubjects[i].child;
                makeChildLinks(parentNodeH2Subjects[i].item, child);
                return; //bye bye
              }
              if(isH4Match){
                for (let i = 0; i < parentNodeH4Subjects.length; i++){
                  let child = childSubjects[i].child;
                  makeChildLinks(parentNodeH4Subjects[i].item, child);
                }
              }

            }

          }

          for (let match of discoveredMatches){
            makeChildLinks(match.parentLink, match.childLink);
            if(match.length < childSubjects.length){ alert("LLMM added additional info that is hidden");}
          }

        }
    </script>

    <script>
       function makeChildLinks(parent, child){
            parent.style.cursor = "pointer";
            parent.style.textDecoration = "underline";
            parent.style.color = "blue";
            parent.onclick = function(){
              setVisibleChild(child.id);
            }
       }

    </script>

<script>window.onload = setChildSubjects;</script>

</body>
</html>


   
    <!-- <textarea id="userPrompt"></textarea>

    <script>
        function nextButton() {
            const userPrompt = document.getElementById('userPrompt').value;
            console.log(userPrompt);
        }
    </script> -->