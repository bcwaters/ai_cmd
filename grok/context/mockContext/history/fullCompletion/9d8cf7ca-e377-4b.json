{"id":"9d8cf7ca-e377-4bee-9ab1-2d1a2fdddc3d","object":"chat.completion","created":1741217078,"model":"grok-2-1212","choices":[{"index":0,"message":{"role":"assistant","content":"To set up the KaTeX extension with marked for parsing READMEs, you need to configure both marked and KaTeX appropriately. Here's a step-by-step guide on how to set this up, including the suggested KaTeX options to use with marked:\n\n### Step 1: Install Dependencies\n\nFirst, ensure you have both `marked` and `katex` installed in your project:\n\n```bash\nnpm install marked katex\n```\n\n### Step 2: Configure Marked with KaTeX\n\nTo use KaTeX with marked, you need to create a custom renderer for marked that will handle LaTeX expressions and render them using KaTeX. Below is an example of how to set this up:\n\n```javascript\nconst marked = require('marked');\nconst katex = require('katex');\n\n// Define a custom renderer\nconst renderer = new marked.Renderer();\n\n// Custom function to handle inline LaTeX\nrenderer.inlineText = function(text) {\n    return text.replace(/\\$\\$(.+?)\\$\\$/g, (match, p1) => {\n        try {\n            return katex.renderToString(p1, {\n                throwOnError: false,\n                displayMode: false,\n            });\n        } catch (error) {\n            return match;\n        }\n    }).replace(/\\$(.+?)\\$/g, (match, p1) => {\n        try {\n            return katex.renderToString(p1, {\n                throwOnError: false,\n                displayMode: true,\n            });\n        } catch (error) {\n            return match;\n        }\n    });\n};\n\n// Configure marked with the custom renderer\nmarked.setOptions({\n    renderer: renderer,\n    gfm: true,\n    tables: true,\n    breaks: false,\n    pedantic: false,\n    sanitize: false,\n    smartLists: true,\n    smartypants: false,\n    xhtml: false\n});\n\n// Example usage\nconst markdownText = 'Here is an inline equation: $E=mc^2$ and a displayed equation: $$E=mc^2$$';\nconst html = marked(markdownText);\nconsole.log(html);\n```\n\n### Suggested KaTeX Options\n\nWhen using KaTeX with marked, the following options are suggested:\n\n- **throwOnError**: Set to `false` to prevent the renderer from crashing if there's an error in the LaTeX code. Instead, it will display the original LaTeX code.\n- **displayMode**: Set to `true` for block equations ($$...$$) and `false` for inline equations ($...$).\n\nThese options ensure that your LaTeX equations are rendered correctly within your Markdown text.\n\n### Troubleshooting Common Issues\n\nIf your parser is not working out of the box, check the following:\n\n- **LaTeX Syntax**: Ensure your LaTeX syntax is correct. KaTeX is quite strict about syntax.\n- **Escaping Characters**: Make sure you're escaping any special Markdown characters that might interfere with LaTeX.\n- **Version Compatibility**: Check that the versions of `marked` and `katex` you're using are compatible.\n\nBy following these steps and using the suggested options, you should be able to successfully set up KaTeX with marked for parsing READMEs containing LaTeX equations.\n\n@EOF@\n[marked, katex, LaTeX, README, parser, inline equations, block equations, npm, renderer, configuration, troubleshooting]","refusal":null},"finish_reason":"stop"}],"usage":{"prompt_tokens":488,"completion_tokens":668,"reasoning_tokens":0,"total_tokens":1156,"prompt_tokens_details":{"text_tokens":488,"audio_tokens":0,"image_tokens":0,"cached_tokens":0}},"system_fingerprint":"fp_5c0c5bd9d9"}